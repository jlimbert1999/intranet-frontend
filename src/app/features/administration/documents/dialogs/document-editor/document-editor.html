<form [formGroup]="documentForm" (ngSubmit)="save()">
  <p-stepper [value]="1">
    <p-step-item [value]="1">
      <p-step>Propieades documentos</p-step>
      <p-step-panel>
        <ng-template #content let-activateCallback="activateCallback">
          <div class="flex flex-col gap-y-4 py-2">
            @if (data) {
              <section class="py-[5px]">
                <div class="mx-auto px-4 sm:container">
                  <div>
                    <h2 class="mb-2 text-2xl font-semibold">
                      {{ data.category.name | titlecase }}
                    </h2>
                    <p class="text-sm font-medium text-body-color">
                      {{ data.section.name | uppercase }}
                    </p>
                  </div>
                </div>
              </section>
            } @else {
              <p-floatlabel class="w-full" variant="on">
                <p-select
                  [options]="sections()"
                  optionLabel="name"
                  optionValue="id"
                  appendTo="body"
                  class="w-full"
                  inputId="sectionDoc"
                  [filter]="true"
                  (onChange)="onSelectSection($event.value)"
                />
                <label for="sectionDoc">Secci√≥n del documento *</label>
              </p-floatlabel>
              <p-floatlabel class="w-full" variant="on">
                <p-select
                  [options]="types()"
                  optionLabel="name"
                  formControlName="relationId"
                  optionValue="id"
                  appendTo="body"
                  class="w-full"
                  inputId="typeDoc"
                  [filter]="true"
                  (onChange)="onSelectType($event.value)"
                />
                <label for="typeDoc">Tipo de documento *</label>
              </p-floatlabel>

              <p-floatlabel class="w-full" variant="on">
                <p-select
                  [options]="subtypes()"
                  optionLabel="name"
                  formControlName="relationId"
                  optionValue="id"
                  appendTo="body"
                  class="w-full"
                  emptyMessage="Sin elementos"
                  inputId="subtype"
                  [filter]="true"
                />
                <label for="subtype">Subtipo (Opcional)</label>
              </p-floatlabel>

              <p-floatlabel variant="on">
                <p-datepicker
                  inputId="yearInput"
                  view="year"
                  dateFormat="yy"
                  showIcon
                  iconDisplay="input"
                  appendTo="body"
                  [fluid]="true"
                />
                <label for="yearInput">Gestion</label>
              </p-floatlabel>
            }
          </div>
          <div class="py-6">
            <p-button label="Siguiente" (onClick)="activateCallback(2)" />
          </div>
        </ng-template>
      </p-step-panel>
    </p-step-item>

    <p-step-item [value]="2">
      <p-step>Archivos</p-step>
      <p-step-panel>
        <ng-template #content let-activateCallback="activateCallback">
          <div class="p-6 bg-surface-0 rounded-xl border border-surface-200">
            <div class="flex mb-4">
              <p-button
                label="Seleccionar"
                variant="outlined"
                icon="pi pi-plus"
                size="small"
                (onClick)="fileInput.click()"
              />
              <input
                #fileInput
                type="file"
                [hidden]="true"
                [multiple]="true"
                (change)="onFileSelect($event)"
              />
            </div>
            <div formArrayName="attachments" class="mt-4 space-y-3">
              <div
                *ngFor="let item of fileMetadata.controls; let i = index"
                [formGroupName]="i"
                class="flex items-center gap-4 p-3 border border-slate-100 rounded-lg bg-slate-50 hover:bg-slate-100 transition-colors"
              >
                <div class="flex-shrink-0">
                  <!-- <i [class]="getFileIcon(item.get('extension')?.value)"></i> -->
                </div>

                <div class="flex-grow">
                  <input
                    type="text"
                    formControlName="displayName"
                    class="w-full bg-transparent border-b border-transparent focus:border-blue-500 focus:outline-none py-1 px-2 text-sm font-medium text-slate-700"
                    placeholder="Nombre del archivo"
                  />
                  <small class="text-xs text-slate-400 block px-2">
                    Original: 
                  </small>
                </div>
                <p-button
                  icon="pi pi-trash"
                  [rounded]="true"
                  [text]="true"
                  severity="danger"
                  (onClick)="removeFile(i)"
                />
              </div>
            </div>

            <div
              *ngIf="fileMetadata.length === 0"
              class="text-center py-8 border-2 border-dashed border-slate-200 rounded-lg mt-4"
            >
              <p class="text-slate-400">No hay archivos seleccionados</p>
            </div>
          </div>
          <div class="py-6">
            <p-button
              label="Atras"
              severity="secondary"
              (onClick)="activateCallback(1)"
            />
          </div>
        </ng-template>
      </p-step-panel>
    </p-step-item>
  </p-stepper>
  <div class="p-dialog-footer">
    <p-button label="Cancelar" severity="secondary" (onClick)="close()" />
    <p-button type="submit" label="Guardar" [disabled]="documentForm.invalid" />
  </div>
</form>
